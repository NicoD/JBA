define(function(){var l,i;l=function(d){var e;this.maxPosition=0;if("function"===typeof ArrayBuffer){ArrayBuffer.prototype.copyInto||(ArrayBuffer.prototype.copyInto=function(d){var c,e=new Uint8Array(this),h=new Uint8Array(d);for(c=0;c<h.length;c++)h[c]=e[c];return d});if(void 0===d)e=new ArrayBuffer(1024);else if(d instanceof ArrayBuffer)e=d,this.maxPosition=e.byteLength;else if("string"===typeof d)e=new ArrayBuffer(d.length);else throw Error("unsupported input "+typeof d);this.ba=new Uint8Array(e)}else this.ba=
[];this.position=0;"string"===typeof d&&(this.maxPosition=d.length,function(e){for(var c,g=0,h=0,g=0;g<d.length;g++)c=d.charCodeAt(g),e[h++]=c&255}(this.ba));this.writeByte=function(d){this.ba[this.position++]=d&255;if(this.position>this.maxPosition){this.maxPosition=this.position;if(typeof ArrayBuffer==="function"&&this.maxPosition>=this.ba.length){e=e.copyInto(new ArrayBuffer(this.ba.length+1024));this.ba=new Uint8Array(e)}}};this.readByte=function(){return this.ba[this.position++]};this.readBytes=
function(d){var c,e;e=typeof ArrayBuffer==="function"?new Uint8Array(new ArrayBuffer(d)):[];for(c=0;c<d;c++)e[c]=this.readByte();return e};this.size=function(){return this.maxPosition}};i=function(d,e){var f,c,g,h,j,i,m,k,n,b;f=-Math.pow(2,7);c=Math.pow(2,7)-1;g=Math.pow(2,8)-1;h=-Math.pow(2,15);j=Math.pow(2,15)-1;i=Math.pow(2,16)-1;m=-Math.pow(2,31);k=Math.pow(2,31)-1;n=Math.pow(2,32)-1;b=new l(d);this.byteOrder=void 0!==e?e:0;this.reset=function(){b.position=0};this.next=function(){++b.position};
this.previous=function(){--b.position};this.to=function(a){b.position=a};this.getPosition=function(){return b.position};this.isUnsignedIntValid=function(a){return!(0>a||a>n)};this.isIntValid=function(a){return!(a<m||a>k)};this.isShortValid=function(a){return!(a<h||a>j)};this.isUnsignedShortValid=function(a){return!(0>a||a>i)};this.isByteValid=function(a){return!(a<f||a>c)};this.isASCIIStringValid=function(a){var b=0;for(b;b<a.length;b++)if(!this.isASCIICharValid(a.substr(b,1)))return!1;return!0};
this.isASCIICharValid=function(a){return 1===a.length&&127>a.charCodeAt(0)};this.isUnsignedByteValid=function(a){return!(0>a||a>g)};this.writeBytes=function(a){var b;for(b=0;b<a.length;b++)this.writeByte(a[b])};this.writeBool=function(a){this.writeByte(+(!0===a))};this.writeASCIIChar=function(a){this.writeByte(a.charCodeAt(0))};this.writeASCIIString=function(a,b){var c=0,d=b?Math.min(a.length,b):a.length;for(c;c<d;c++)this.writeASCIIChar(a.substr(c,1));for(void 0===b&&this.writeASCIIChar("\x00");c++<
b;)this.writeASCIIChar("\x00")};this.writeUnsignedInt=function(a){switch(this.byteOrder){case 0:b.writeByte(a>>24);b.writeByte(a>>16);b.writeByte(a>>8);b.writeByte(a);break;case 1:b.writeByte(a),b.writeByte(a>>8),b.writeByte(a>>16),b.writeByte(a>>24)}};this.writeInt=function(a){this.writeUnsignedInt(a)};this.writeUnsignedShort=function(a){switch(this.byteOrder){case 0:b.writeByte(a>>8);b.writeByte(a);break;case 1:b.writeByte(a),b.writeByte(a>>8)}};this.writeShort=function(a){this.writeUnsignedShort(a)};
this.writeUnsignedByte=function(a){b.writeByte(a)};this.writeByte=function(a){this.writeUnsignedByte(a)};this.readBool=function(){return 1===this.readByte()};this.readASCIIChar=function(){return String.fromCharCode(this.readByte())};this.readASCIIString=function(a){for(var c="",d;"\x00"!==(d=this.readASCIIChar());)c+=d;for(;--a>c.length;)++b.position;return c};this.readUnsignedInt=function(){var a;switch(this.byteOrder){case 0:a=b.readByte()<<24;a|=b.readByte()<<16;a|=b.readByte()<<8;a|=b.readByte();
break;case 1:a=b.readByte(),a|=b.readByte()<<8,a|=b.readByte()<<16,a|=b.readByte()<<24}return 0>a?Math.pow(2,32)+a:a};this.readInt=function(){var a=this.readUnsignedInt();return a>k?a-Math.pow(2,32):a};this.readUnsignedShort=function(){switch(this.byteOrder){case 0:return b.readByte()<<8|b.readByte();case 1:return b.readByte()|b.readByte()<<8}};this.readShort=function(){var a=this.readUnsignedShort();return a>j?a-Math.pow(2,16):a};this.readUnsignedByte=function(){return b.readByte()};this.readBytes=
function(a){return b.readBytes(a)};this.readByte=function(){var a=this.readUnsignedByte();return a>c?a-Math.pow(2,8):a};this.size=function(){return b.size()};this.toString=function(){if(0===this.size())return null;b.position=0;var a="";do a+=String.fromCharCode(b.readByte());while(b.position<b.size());return a};this.toArrayBuffer=function(){if("function"!==typeof ArrayBuffer)throw Error("Array Buffer not compatible in the browser");var a=new ArrayBuffer(this.size()),c=new Uint8Array(a);b.position=
0;do c[b.position]=b.readByte();while(b.position<b.size());return a}};return{create:function(d,e){var f,c;d&&!e?0===d||1===d?c=d:f=d:d&&e&&(f=d,c=e);return new i(f,c)},sendRequest:function(d,e,f){var c=null;window.ActiveXObject?c=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(c=new XMLHttpRequest);c.open("GET",d,!0);void 0!==c.responseType&&(c.responseType="arraybuffer");c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined");c.onload=function(){if(c.status===
200||c.status===206||c.status===0){c.binaryResponse=c.responseType!==void 0?this.response:c.responseText;e(c)}else f&&f();c=null};c.send()},BIG_ENDIAN:0,LITTLE_ENDIAN:1,INT_BYTE_SIZE:4,SHORT_BYTE_SIZE:2}});